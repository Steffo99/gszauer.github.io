<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<title>Game Animation Programming</title>
		<meta name="description" content="Game Animation Programming">
		<meta name="author" content="Gabor Szauer">

		<script src="vector.js"></script>
		<script src="matrix.js"></script>
		<script src="quaternion.js"></script>
		<script src="transform.js"></script>
		<script src="graphics.js"></script>
		<script src="animation.js"></script>
		<script src="mesh.js"></script>

		<script src="sample.js"></script>
		<script src="full.js"></script>

		<script type="text/javascript">
			var gApplication = null;

			function loop() {
				gApplication.Loop();
			}

			function main() {
				let canvas = document.querySelector("#glCanvasThree");
				let gl = canvas.getContext("webgl");
				gl.enable(gl.DEPTH_TEST);
				gl.enable(gl.CULL_FACE);
				if (gl === null) {
					alert("Unable to initialize WebGL. Your browser or machine may not support it.");
					return;
				}
				gApplication = new FullPageAnimated(gl, canvas);

				window.setInterval(loop, 16);
			}

			window.onload = main;

			window.onresize = function() {
				document.body.height = window.innerHeight;
			}
		</script>

		<link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">

<link href="https://fonts.googleapis.com/css?family=Cutive+Mono&display=swap" rel="stylesheet">

		<style>
			body {
				background-color: #4F5460;
				font-family: 'Open Sans', sans-serif;
			}
			div {
				border-style: none;
				max-width: 800px;
				margin: auto;
				margin-top: 20px;
				margin-bottom: 20px;
				padding: 20px;
				background-color: #383F47;
				text-align: left;
			}
			p {
				font-size: 1em;
			}
			h1, h2 {
				color: #E4E7EB;
			}
			div.section>h1 {
				background-color: #273038;
				margin-top: -20px;
				margin-left: -20px;
				margin-right: -20px;
				padding: 20px;
			}
			div.section>h2 {
				background-color: #273038;
				font-size: 1.2em;
				padding: 10px;
				margin: 0px;
				margin-left: -20px;
				margin-right: -20px;
			}
			div.info {
				padding: 0px;
				margin-left: 0px;
				margin-right: 0px;
			}
			div.info>h1 {
				font-size: 1.2em;
				background-color: #273038;
				margin: 0px;
				padding: 10px;
			}
			div.info>p {
				background-color: #52606D;
				margin: 0px;
				padding: 10px;
			}
			div.gldemo {
				padding: 0px;
				margin-left: 0px;
				margin-right: 0px;
			}
			p {
				color: #CBD2D9;
			}
			pre {
				background-color: #52606D;
				border: 2px solid #273038;
				padding: 10px;
				font-family: 'Cutive Mono', monospace;
				color: #f2c8ae;
			}
			p>code {
				font-family: 'Cutive Mono', monospace;
				font-size: 1.1em;
			}
			a:link, a:visited {
				font-weight: bold;
				color: #B3BCD8;
				text-decoration: none;
			}
			a:hover, a:active {
				font-weight: bold;
				color: #BECCD6;
				text-decoration: none;
			}
		</style>
	</head>

	<body>
		<div class="section">
			<h1 clasa="title">Animation Overview</h1>
			<p>This site is a complete tutorial about animation programming. Reading trough the site, you can learn how to build a robust animation system. The book covers all of these topics in more detail, as well as advanced animation techniques.</p>

			<p>Generally, game animation can be broken up into three distinct steps. These steps are pose generation, pose modification and skinning. The steps are usually performed in order.</p>

			<div class="info">
				<h1>Pose generation</h1>
				<p>When talking about humanoid animations, a pose refers to the skeleton. Specifically the skeleton posed to match a frame of animation. You would generate a pose by sampling an animation clip.</p>
			</div>

			<div class="info">
				<h1>Pose modification</h1>
				<p>Pose modification is exactly what it sounds like, modifying the pose before it is skinned. Blending two animation clips to hide a transition would be considered pose modification, so would an IK system that adjusts a leg to keep in on top of terrain. This site will cover animation blending, the book covers blending in more detail. The book also covers more advanced topics like IK.</p>
			</div>

			<div class="info">
				<h1>Skinning</h1>
				<p>Given a mesh and a pose, skinning is the process of deforming the mesh so that is matches the given pose. The two most common skinning methods are matrix palette skinning and dual quaternion skinning. We will cover matrix palette skinning on this page, both are covered in the book.</p>
			</div>

			<p>All three of these topics are covered on this webpage, they are also covered more in-depth in the book. The code here and the code for the book are not the same! For example, in the book you will learn to load gltf files, on this page you will learn how to load fbx files.</p>

			<p>The Game Aniamtion book covers everything from the basics of creating an OpenGL 3.3 enabled window to advanced animation techniques like dual quaternion skinning, crowd rendering and ik. Most of the assets used on this site and in the book are <a href="http://quaternius.com/">free game assets by Quaternius</a> and <a href="https://github.com/GDQuest/godot-3d-mannequin">Open 3D Mannequin</a></p>
		</div>
		<div class="section">
			<h1>Getting started</h1>
			<p>I&apos;m assuming that you are familiar with C++ and Windows programing. To follow along with this page, you should be able to open a new window and set up an OpenGL context to render to. I&apos;m also assuming that you are familiar with OpenGL. These topics won&apos;t be covered on the site, but they are covered in the book.</p>
			<p>The code that i&apos;ll be using to create the animation system is on <a href="https://github.com/gszauer/TLDRGameAnimation/Start">Github</a>. It&apos;s actually the code from Chapter 5 of the book.</p>
		</div>
		<div class="section">
			<h1>Math</h1>
			<p>I&apos;m going to assume that you are familiar with <a href="https://gabormakesgames.com/vectors.html">Vectors</a>, <a href="https://gabormakesgames.com/matrices.html">Matrices</a>, <a href="https://gabormakesgames.com/quaternions.html">Quaternions</a> and <a href="https://gabormakesgames.com/transforms.html">Linear Transformations</a>. All of these topics are covered in the book, they are also covered on my blog, <a href="https://gabormakesgames.com">Gabor Makes Games</a>. The <a href="https://github.com/gszauer/TLDRGameAnimation/Start">Starting Code</a> already contains code for these constructs. </p>
		</div>
		<div class="section">
			<h1>Curves</h1>
			<p>To animate game objects in code, you will need some understanding of curves. Let&apos;s start with the <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">(cubic) B&eacute;zier curve</a>.A B&eacute;zier curve segment has two points to interpolate between and two control points. These four points generate a curve. The image below has the points labeled as <code>P1</code>, <code>P2</code> and the control points as <code>C1</code> and <code>C2</code>.</p>
			<p>TODO:IMAGE</p>
			
			<p>Given the two points and the two controls, how can we generate a curve? Let&apos;s explore interpolating for a given time, <code>t</code>. Start by drawing a line from <code>P1</code> to <code>C1</code>, from <code>C1</code> to <code>C2</code> and a line from <code>C2</code> to <code>P2</code>. Then, linearly interpolate along those lines by the value of <code>t</code>.</p>
			<p>TODO: Image</p>

			<p>The interpolated points from <code>P1</code> to <code>C1</code> form a line, let&apos;s call it <code>A</code>. The interpolated points from <code>C2</code> to <code>P2</code> form a line as well, let&apos;s call it <code>B</code>. Finally, the interpolated points from <code>C1</code> to <code>C2</code> form a line, let&apos;s call it <code>C</code>. Repeat the process and linearly interpolate along <code>A</code> to <code>C</code> and <code>C</code> to <code>B</code>. The resulting points will be called <code>E</code> and <code>F</code> respectivley.</p>
			<p>TODO: Iamge</p>

			<p>One more time, interpolate along the line that is formed between <code>E</code> and <code>F</code> by <code>t</code>. The resulting point will be called <code>R</code>. This resulting point <code>R</code> can be plotted on the B&eacute;zier curve. If we calculate all points from <code>t=0</code> to <code>t-1</code>, the B&eacute;zier curve can be plotted.</p>
			<p>TODO: Image</p>

			<p>Let&apos;s try to implement a B&eacute;zier curve segment in code. This implementation won&apos;t be used in the animation system. The definition of the data structure is trivial, it holds two points and two control points.</p>
<pre><code>template<typename T>
class Bezier {
public:
    T P1; // Point 1
    T C1; // Control 1
    T P2; // Point 2
    T C2; // Control 2
};
</code></pre>

			<p>Next, imlplement the interpolate function. As shown earlier, interpolating a B&eacute;zier curve segment can be implemented using 5 lerp operations.</p>
<pre><code>template<typename T>
inline T Interpolate(const Bezier<T>& curve, float t) {
    T A = lerp(curve.P1, curve.C1, t);
    T B = lerp(curve.C2, curve.P2, t);
    T C = lerp(curve.C1, curve.C2, t);

    T D = lerp(A, C, t);
    T E = lerp(C, B, t);

    T R = lerp(D, E, t);
    return R;
}
</code></pre>

			<p>That&apos;s actually all we really need. Plotting this segment is trivial. First, initalize a segment to draw.</p>
<pre><code>Bezier<vec3> curve;
curve.P1 = vec3(-5, 0, 0);
curve.P2 = vec3(5, 0, 0);
curve.C1 = vec3(-2, 1, 0);
curve.C2 = vec3(2, 1, 0);
    
vec3 red = vec3(1, 0, 0);
vec3 green = vec3(0, 1, 0);
vec3 blue = vec3(0, 0, 1);
vec3 magenta = vec3(1, 0, 1);
</code></pre>

			<p>Next, draw the curves points and handles.</p>
<pre><code>// Draw all relevant points
DrawPoint(curve.P1, red);
DrawPoint(curve.C1, green);
DrawPoint(curve.P2, red);
DrawPoint(curve.C2, green);

// Draw handles
DrawLine(curve.P1, curve.C1, blue);
DrawLine(curve.P2, curve.C2, blue);
</code></pre>

			<p>Finally, we can plot the actual curve.</p>
<pre><code>// Draw the actual curve
// Resolution is 200 steps since last point is i + 1
for (int i = 0; i < 199; ++i) {
    float t0 = (float)i / 199.0f;
    float t1 = (float)(i + 1) / 199.0f;

    vec3 thisPoint = Interpolate(curve, t0);
    vec3 nextPoint = Interpolate(curve, t1);

    DrawLine(thisPoint, nextPoint, magenta);
}
</code></pre>

			<p>Assuming there is a &quot;<code>DrawLine</code>&quot; and &quot;<code>DrawPoint</code>&quot; function declared, the above code should draw something that looks like this.</p>
			<p>TODO: Image</p>


		</div>
		<div class="section">
			<h1>Pose generation</h1>
			<p>TODO</p>
		</div>
		<div class="section">
			<h1>Load pose from FBX</h1>
			<p>TODO</p>
		</div>
		<div class="section">
			<h1>Skinning</h1>
			<p>TODO</p>
			<div class="gldemo">
				<canvas id="glCanvasThree" style="width: 100%; height:100%;"></canvas>
			</div>
		</div>
		<div class="section">
			<h1>Load mesh from FBX</h1>
			<p>TODO</p>
		</div>
		<div class="section">
			<h1>Pose modification</h1>
			<p>TODO</p>
		</div>
		<div class="section">
			<h1>What&lsquo;s next?</h1>
			<p>TODO</p>
		</div>
	</body>
</html>